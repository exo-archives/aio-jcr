<project>
  <modelVersion>4.0.0</modelVersion>
  <groupId>org.exoplatform.jcr</groupId>
  <artifactId>config</artifactId>
  <name>eXo JCR Config</name>
  <version>1.6</version>
  <packaging>pom</packaging>

  <modules>
    <module>component/core</module>
    <module>component/ext</module>

    <module>component/rmi</module>
    <module>component/ftp</module>
    <module>component/webdav</module>

    <module>frameworks/command</module>
    <module>frameworks/web</module>

    <module>frameworks/webdavclient</module>
    <module>frameworks/ftpclient</module>


    <module>connectors/jca</module>

    <!-- check readme.txt in the project -->
    <!-- module>connectors/rmiadapter</module -->

    <module>applications/java/web/samples/browser</module>
    <module>applications/java/web/samples/fckeditor</module>
    <module>applications/java/web/webdav</module>
    <module>applications/java/standalone/rmi-server</module>
    <module>applications/java/standalone/rmi-client</module>

    <module>applications/java/standalone/samples/webdav-browser</module>
    <!-- module>applications/java/standalone/openofficeplugin</module -->

    <!-- module>applications/jcr-console</module -->
    <module>site</module>
  </modules>

  <build>
    <!-- sourceDirectory>src/main/java</sourceDirectory>
    <outputDirectory>target/classes</outputDirectory>

    <testSourceDirectory>src/test/java</testSourceDirectory>
    <testOutputDirectory>target/test-classes</testOutputDirectory -->

    <resources>
        <resource>
            <directory>src/main/java</directory>
            <includes>
                <include>**/*.xml</include>
                <include>**/*.xsl</include>
                <include>**/*.properties</include>
                <include>**/*.ion</include>
            </includes>
        </resource>
        <resource>
            <directory>src/main/resources</directory>
            <includes>
                <include>**/*.xml</include>
                <include>**/*.xsl</include>
                <include>**/*.properties</include>
                <include>**/login.conf</include>
                <include>**/*.ion</include>
            </includes>
        </resource>
    </resources>
    <testResources>
        <testResource>
            <directory>src/test/java</directory>
            <includes>
                <include>**/*.properties</include>
                <include>**/*.xml</include>
                <include>**/*.txt</include>
            </includes>
        </testResource>
        <testResource>
            <directory>src/test/resources</directory>
            <includes>
                <include>**/*.properties</include>
                <include>**/*.xml</include>
                <include>**/*.txt</include>
            </includes>
        </testResource>
    </testResources>

    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-compiler-plugin</artifactId>
        <configuration>
            <source>1.5</source>
            <target>1.5</target>
            <optimize>${exo.compile.optimize}</optimize>
        </configuration>
      </plugin>

      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-surefire-plugin</artifactId>
        <configuration>
          <skip>${exo.test.skip}</skip>
          <useFile>${exo.test.use.file}</useFile>
          <forkMode>once</forkMode><!--once , pertest -->
          <testFailureIgnore>${exo.test.failure.ignore}</testFailureIgnore>
          <includes>
            <include implementation="java.lang.String">**/${test.classes}*.java1</include>
          </includes>
        </configuration>
      </plugin>

      <!-- eXo Plugin -->
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-exo-plugin</artifactId>
        <extensions>true</extensions>
        <configuration>
          <packagingConfigs>
            <PackagingConfiguration>
              <type>exo-portal</type>
              <sharePortalWebappDirs>
                <!-- sharePortalWebappDir>${exo.directory.v2.x}/exo-portal/web/share-portal</sharePortalWebappDir -->
                <sharePortalWebappDir>${exo.projects.directory.src}/portal/trunk/web/portal/src/main/webapp</sharePortalWebappDir>
              </sharePortalWebappDirs>
              <outputFileName>${project.build.finalName}</outputFileName>
              <outputDirectory>${basedir}/target</outputDirectory>
              <ignoredFiles>${exo.ignore.files}</ignoredFiles>
              <scripts>
                <script>org.exoplatform.maven.plugin.exo.Command$CopyShareDir.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$CopyWebappDir.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$CopyBPARDependency.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$CopyExoAppletDependencies.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$WarArchive.class</script>
                <!--
                An example of the groovy script command.
                Remove this comment out and go to exo-portal/web/portal, type mvn clean install
                You will see a GROOVY COMMAND message and dir target/portal is deleted
                <script>
                  def file = packagingConfig.getOutputDirectory() + "/" +
                  packagingConfig.getOutputFileName();
                  print "\n\n[GROOVY COMMAND] Deleting the  directory: " + file  + "\n\n";
                  FileUtil.deleteDirectory(file) ;
                </script>
                -->
              </scripts>
            </PackagingConfiguration>
            <PackagingConfiguration>
              <type>exo-portlet</type>
              <outputFileName>${project.build.finalName}</outputFileName>
              <outputDirectory>${basedir}/target</outputDirectory>
              <ignoredFiles>${exo.ignore.files}</ignoredFiles>
              <scripts>
                <script>org.exoplatform.maven.plugin.exo.Command$CopyWebappDir.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$CopyFilesResource.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$AddExoPortletDeployer.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$WarArchive.class</script>
              </scripts>
            </PackagingConfiguration>
            <PackagingConfiguration>
              <type>exo-war</type>
              <outputFileName>${project.build.finalName}</outputFileName>
              <outputDirectory>${basedir}/target</outputDirectory>
              <ignoredFiles>${exo.ignore.files}</ignoredFiles>
              <scripts>
                <script>org.exoplatform.maven.plugin.exo.Command$CopyWebappDir.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$WarArchive.class</script>
              </scripts>
            </PackagingConfiguration>
            <PackagingConfiguration>
              <type>bpar</type>
              <scripts>
                <script>org.exoplatform.maven.plugin.exo.Command$PrepareBPARDir.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$JarArchive.class</script>
              </scripts>
            </PackagingConfiguration>
          </packagingConfigs>

          <deployConfigurations>
            <DeployConfiguration>
              <serverType>tomcat-server</serverType>
              <serverPatchs>
                <!-- serverPatch>${exo.directory.v2.x}/exo-tools/server/tomcat/patch</serverPatch -->
                <serverPatch>${exo.projects.directory.src}/portal/trunk/server/tomcat/patch</serverPatch>
              </serverPatchs>
              <!-- serverConfig>${exo.directory.v2.x}/exo-tools/server/tomcat</serverConfig -->
              <serverConfig>${exo.projects.directory.src}/portal/trunk/server/tomcat</serverConfig>
              <deployServerDir>${exo.projects.directory.working}/exo-tomcat</deployServerDir>
              <deployLibDir>${exo.projects.directory.working}/exo-tomcat/common/lib</deployLibDir>
              <deployWebappDir>${exo.projects.directory.working}/exo-tomcat/webapps</deployWebappDir>
              <cleanServerDir>${exo.projects.directory.dependencies}/${exo.server.tomcat}</cleanServerDir>
              <useCleanServer>${clean}</useCleanServer>
              <defaultPortalDir>${exo.projects.directory.working}/exo-tomcat/webapps/portal</defaultPortalDir>
              <ignoredFiles>${exo.ignore.files}</ignoredFiles>
              <deployDependencyScope>${scope}</deployDependencyScope>
              <excludeProjects>${exo.exclude.projects}, commons-collections</excludeProjects>
              <scripts>
                <script>org.exoplatform.maven.plugin.exo.Command$NewServer.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$PatchServerConfig.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$DeployProject.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$CreatePortalXml.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$ExplodeWars.class</script>
              </scripts>
            </DeployConfiguration>
            <DeployConfiguration>
              <serverType>jboss-server</serverType>
              <!-- serverConfig>${exo.directory.v2.x}/exo-tools/server/jboss</serverConfig -->
              <serverConfig>${exo.projects.directory.src}/portal/trunk/server/jboss</serverConfig>
              <deployServerDir>${exo.projects.directory.working}/exo-jboss</deployServerDir>
              <deployLibDir>${exo.projects.directory.working}/exo-jboss/server/default/deploy/exoplatform.sar</deployLibDir>
              <deployWebappDir>${exo.projects.directory.working}/exo-jboss/server/default/deploy/exoplatform.sar</deployWebappDir>
              <cleanServerDir>${exo.projects.directory.dependencies}/${exo.server.jboss}</cleanServerDir>
              <deployDependencyScope>${scope}</deployDependencyScope>
              <useCleanServer>${clean}</useCleanServer>
              <ignoredFiles>${exo.ignore.files}</ignoredFiles>
              <excludeProjects>${exo.exclude.projects}</excludeProjects>
              <scripts>
                <script>org.exoplatform.maven.plugin.exo.Command$NewServer.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$PatchConfigJboss.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$DeployProject.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$CreateManifest.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$CreateEarApplicationXml.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$ExplodeWars.class</script>
              </scripts>
            </DeployConfiguration>
            <DeployConfiguration>
              <serverType>jonas-server</serverType>
              <serverPatchs>
                <!-- serverPatch>${exo.directory.v2.x}/exo-tools/server/jonas/patch</serverPatch -->
                <serverPatch>${exo.projects.directory.src}/portal/trunk/server/jonas</serverPatch>
              </serverPatchs>
              <!-- serverConfig>${exo.directory.v2.x}/exo-tools/server/jonas</serverConfig -->
              <serverConfig>${exo.projects.directory.src}/portal/trunk/server/jonas</serverConfig>
              <deployServerDir>${exo.projects.directory.working}/exo-jonas</deployServerDir>
              <deployLibDir>${exo.projects.directory.working}/exo-jonas/lib/apps</deployLibDir>
              <deployWebappDir>${exo.projects.directory.working}/exo-jonas/apps/autoload/exoplatform.ear</deployWebappDir>
              <deployEjbDir>${exo.projects.directory.working}/exo-jonas/apps/autoload/exoplatform.ear</deployEjbDir>
              <deployRarDir>${exo.projects.directory.working}/exo-jonas/apps/autoload/exoplatform.ear</deployRarDir>
              <cleanServerDir>${exo.directory.dependencies}/${exo.server.jonas}</cleanServerDir>
              <deployDependencyScope>${scope}</deployDependencyScope>
              <useCleanServer>${clean}</useCleanServer>
              <ignoredFiles>${exo.ignore.files}</ignoredFiles>
              <excludeProjects>${exo.exclude.projects}</excludeProjects>
              <scripts>
                <script>org.exoplatform.maven.plugin.exo.Command$NewServer.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$PatchServerConfig.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$DeployProject.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$CreateManifest.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$CreateEarApplicationXml.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$ExplodeWars.class</script>
                <script>
                  def DeployServerDir = deployConfig.getDeployServerDir();
                  if (System.getProperty("os.name").toLowerCase().startsWith("win")) {
                    def process = DeployServerDir + "\\bin\\nt\\post-patch.bat";
                  }
                  else {
                    def process = DeployServerDir + "/bin/unix/post-patch.sh";
                    try {
                      ("chmod +x " + process).execute().in.eachLine { println it };
                    } catch(Exception e) {
                      System.err.println("[ERROR] " + e.toString());
                    }
                  }
                  try {
                    print "\n[PATCH] Moving appropriate files to complete deployment\n";
                    process.execute().in.eachLine { println it };
                  } catch(Exception e) {
                    System.err.println("[ERROR] " + e.toString());
                  }
                </script>
              </scripts>
            </DeployConfiguration>
          </deployConfigurations>

          <releaseConfigurations>
            <ReleaseConfiguration>
              <serverType>tomcat-server</serverType>
              <deployDirectory>${exo.projects.directory.working}/exo-tomcat</deployDirectory>
              <releaseDirectory>${exo.projects.directory.release}/exo-tomcat</releaseDirectory>
              <sourceDirectory>${exo.directory.v2.x}</sourceDirectory>
              <ignoredFiles>${exo.ignore.files}</ignoredFiles>
              <releaseFileName>eXo-tomcat-v2.x</releaseFileName>
              <releaseSrcName>src-eXo-v2.x</releaseSrcName>
              <scripts>
                <script>org.exoplatform.maven.plugin.exo.Command$DeleteTempInTomcat.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$ReleaseSrcCode.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$ReleaseProject.class</script>
              </scripts>
            </ReleaseConfiguration>
            <ReleaseConfiguration>
              <serverType>jboss-server</serverType>
              <deployDirectory>${exo.projects.directory.working}/exo-jboss/server/default/deploy/exoplatform.sar</deployDirectory>
              <releaseDirectory>${exo.projects.directory.release}/exo-jboss</releaseDirectory>
              <sourceDirectory>${exo.directory.v2.x}</sourceDirectory>
              <releaseFileName>exoplatform.sar</releaseFileName>
              <ignoredFiles>${exo.ignore.files}</ignoredFiles>
              <releaseSrcName>src-eXo-v2.x</releaseSrcName>
              <scripts>
                <script>org.exoplatform.maven.plugin.exo.Command$ReleaseSrcCode.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$ReleaseProject.class</script>
              </scripts>
            </ReleaseConfiguration>
            <ReleaseConfiguration>
              <serverType>jonas-server</serverType>
              <deployDirectory>${exo.projects.directory.working}/exo-jonas/</deployDirectory>
              <sourceDirectory>${exo.directory.v2.x}</sourceDirectory>
              <releaseDirectory>${exo.projects.directory.release}/exo-jonas</releaseDirectory>
              <releaseFileName>eXo-jonas-v2.x</releaseFileName>
              <ignoredFiles>${exo.ignore.files}</ignoredFiles>
              <releaseSrcName>src-eXo-v2.x</releaseSrcName>
              <scripts>
                <script>org.exoplatform.maven.plugin.exo.Command$ReleaseSrcCode.class</script>
                <script>org.exoplatform.maven.plugin.exo.Command$ReleaseProject.class</script>
              </scripts>
            </ReleaseConfiguration>
          </releaseConfigurations>
        </configuration>
      </plugin>

    </plugins>
  </build>

  <repositories>
    <repository>
      <id>local-jcr</id>
      <url>file:${exo.projects.directory.src}/jcr/trunk/maven/repository</url>
    </repository>
    <repository>
      <id>maven.org</id>
      <url>http://repo1.maven.org/maven2</url>
    </repository>
    <repository>
      <id>exo-vietnam</id>
      <url>http://vnserver.exoplatform.org/maven2</url>
    </repository>
    <repository>
      <id>objectweb.org</id>
      <url>http://maven.objectweb.org/maven2</url>
    </repository>
    <repository>
      <id>ibiblio.org</id>
      <url>http://www.ibiblio.org/maven2</url>
    </repository>
    <repository>
      <id>objectweb.org-snapshot</id>
      <url>http://maven.objectweb.org/maven2-snapshot/</url>
    </repository>
    <repository>
      <id>java.net</id>
      <url>https://maven-repository.dev.java.net/nonav/repository</url>
      <layout>legacy</layout>
    </repository>
  </repositories>

  <profiles>
    <profile>
      <id>default</id>
      <activation>
        <property><name>default</name></property>
        <activeByDefault>true</activeByDefault>
      </activation>
      <properties>
        <org.exoplatform.tool.version>2.0.3</org.exoplatform.tool.version>
        <org.exoplatform.kernel.version>2.0.3</org.exoplatform.kernel.version>
        <org.exoplatform.core.version>2.0.3</org.exoplatform.core.version>
        <org.exoplatform.jcr.version>1.6</org.exoplatform.jcr.version>


        <!-- exo.platform.version>2.0.3</exo.platform.version>
        <exo.portlet-container.version>1.5</exo.portlet-container.version>
        <exo.portal.version>1.1.4</exo.portal.version>
        <exo.jcr.version>1.5</exo.jcr.version>
        <exo.ecm.version>1.0</exo.ecm.version>
        <exo.sso.version>1.0</exo.sso.version>
        <exo.sso.cas2.version>1.0</exo.sso.cas2.version -->
      </properties>
    </profile>
  </profiles>
</project>
