<?xml version="1.0" encoding="ISO-8859-1"?>

<configuration>

  <component>
    <key>org.exoplatform.services.log.LogConfigurationInitializer</key>
    <type>org.exoplatform.services.log.LogConfigurationInitializer</type>
    <init-params>
      <value-param>
        <name>logger</name>
        <value>org.exoplatform.services.log.impl.BufferedLog4JLogger</value>
      </value-param>
      <value-param>
        <name>configurator</name>
        <value>org.exoplatform.services.log.impl.Log4JConfigurator</value>
      </value-param>
      <properties-param>
        <name>properties</name>
        <description>Log4J properties</description>
        <property name="log4j.rootLogger" value="INFO, stdout, file"/>
        <property name="log4j.category.jcr.Test" value="DEBUG, stdout, file"/>

        <property name="log4j.appender.stdout" value="org.apache.log4j.ConsoleAppender"/>

        <property name="log4j.appender.stdout.layout" value="org.apache.log4j.PatternLayout"/>
        <property name="log4j.appender.stdout.layout.ConversionPattern" value="%d{dd.MM.yyyy HH:mm:ss} *%-5p* [%t] %c{1}: %m (%F, line %L) %n"/>

        <property name="log4j.appender.file" value="org.apache.log4j.FileAppender"/>
        <property name="log4j.appender.file.File" value="../logs/jcr.log"/>

        <property name="log4j.appender.file.layout" value="org.apache.log4j.PatternLayout"/>
        <property name="log4j.appender.file.layout.ConversionPattern" value="%d{dd.MM.yyyy HH:mm:ss} *%-5p* [%t] %c{1}: %m (%F, line %L) %n"/>

        <property name="log4j.category.jcr.DocNodeImporter" value="DEBUG"/>
      </properties-param>
    </init-params>
  </component>

  <component>
    <key>org.exoplatform.services.jcr.config.RepositoryServiceConfiguration</key>
    <type>org.exoplatform.services.jcr.impl.config.RepositoryServiceConfigurationImpl</type>
    <init-params>
      <value-param>
        <name>conf-path</name>
        <description>JCR configuration file</description>
        <value>jar:/conf/portal/exo-jcr-config.xml</value>
      </value-param>
    </init-params>
   </component>

  <component>
    <key>org.exoplatform.services.jcr.RepositoryService</key>
    <type>org.exoplatform.services.jcr.impl.RepositoryServiceImpl</type>
   </component>

  <external-component-plugins>
    <target-component>org.exoplatform.services.database.jdbc.DBSchemaCreator</target-component>
      <component-plugin>
          <name>jcr.dbschema</name>
          <set-method>addPlugin</set-method>
          <type>org.exoplatform.services.database.jdbc.CreateDBSchemaPlugin</type>
          <init-params>
            <value-param>
              <name>data-source</name>
              <value>jdbcjcr</value>
            </value-param>
            <value-param>
              <name>script-file</name>
              <value>conf/storage/jcr-sjdbc.derby.sql</value>
            </value-param>
          </init-params>
      </component-plugin>
  </external-component-plugins>
  <external-component-plugins>
    <target-component>org.exoplatform.services.naming.InitialContextInitializer</target-component>
    <component-plugin>
      <name>bind.datasource</name>
      <set-method>addPlugin</set-method>
      <type>org.exoplatform.services.naming.BindReferencePlugin</type>
      <init-params>
        <value-param>
          <name>bind-name</name>
          <value>jdbcjcr</value>
        </value-param>
        <value-param>
          <name>class-name</name>
          <value>javax.sql.DataSource</value>
        </value-param>
        <value-param>
          <name>factory</name>
          <value>org.apache.commons.dbcp.BasicDataSourceFactory</value>
        </value-param>
        <properties-param>
          <name>ref-addresses</name>
          <description>ref-addresses</description>
          <property name="driverClassName" value="org.apache.derby.jdbc.EmbeddedDriver"/>
          <property name="url" value="jdbc:derby:../temp/derby/exodb;create=true"/>
        </properties-param>
      </init-params>
    </component-plugin>
  </external-component-plugins>

</configuration>
